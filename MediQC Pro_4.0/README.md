# 电子病案首页质控系统

这是一个基于Python和Flask的电子病案首页质控系统，用于检查病案首页数据中的缺项和逻辑错误，帮助医疗机构提高病案质量，规范医疗记录。系统还提供了医学文本实体识别、文本转Excel等功能。

## 项目背景

医疗机构的病案首页是医疗记录的重要组成部分，包含了患者的基本信息、诊断结果、治疗过程等关键数据。高质量的病案首页对于医疗质量管理、医保报销、医学研究等都有重要意义。本系统旨在通过自动化检查和智能分析，帮助医疗机构发现并解决病案首页中的各类问题。

## 功能特点

### 数据质控功能

- **自定义质控规则管理**：
  - 添加、修改、删除规则
  - 直观的Web界面配置规则
  - 规则持久化存储

- **多种类型的规则检查**：
  - **缺项检查**：检查字段是否为空或非空
  - **逻辑检查**：根据条件检查字段值（等于、不等于、大于、小于、包含、不包含）
  - **关联逻辑检查**：检查两个字段之间的值关系

- **结果展示与处理**：
  - 直观显示检查结果，高亮错误数据
  - 详细的错误描述和位置信息
  - 支持导出检查结果为CSV文件，便于后续处理

### 医学实体识别功能

- **传统医学实体识别**：
  - 基于词典匹配的医学实体识别
  - 支持自定义实体类别和词典
  - 识别结果高亮显示

- **大模型医学实体识别**：
  - 基于Transformer模型的医学实体识别
  - 支持离线模式下的规则匹配识别
  - 实体识别结果可视化（饼状图展示各类实体占比）

### 数据转换功能

- **医疗文本转Excel**：
  - 支持多种文本格式（每行一个字段、分号分隔字段、混合格式）
  - 自动检测文本格式和数据类型
  - 生成标准化Excel文件

- **数据库转Excel**：
  - 支持从医院电子病历数据库导出数据
  - 可定制导出字段和条件
  - 生成符合质控要求的Excel文件

## 系统架构

- **前端**：HTML、CSS、JavaScript、Bootstrap 5、Chart.js
- **后端**：Python、Flask
- **数据处理**：Pandas、Openpyxl
- **AI模型**：Transformers（可选）
- **数据存储**：JSON文件存储规则，支持扩展为数据库存储

## 安装与部署

### 环境要求

- Python 3.6+
- 支持Windows、Linux、MacOS等操作系统

### 安装步骤

1. 克隆或下载本项目代码
2. 安装依赖包：

```bash
pip install -r requirements.txt
```

3. 创建必要的目录（如果不存在）：

```bash
mkdir -p data uploads excel_data
```

4. 运行应用：

```bash
python app.py
```

5. 在浏览器中访问：`http://127.0.0.1:5000`

### 生产环境部署

对于生产环境，建议：

1. 使用Gunicorn或uWSGI作为WSGI服务器
2. 配置Nginx作为反向代理
3. 设置适当的安全策略，如HTTPS、访问控制等
4. 修改`app.py`中的`app.secret_key`为强随机密钥
5. 将`debug=False`设置在生产环境中

## 使用指南

### 规则管理

1. 点击首页中的"规则管理"，进入规则管理页面
2. 添加、编辑或删除质控规则
3. 规则支持缺项检查、逻辑检查和关联逻辑检查

### 数据检查

1. 点击首页中的"开始检查"，进入数据检查页面
2. 上传Excel格式的病案首页数据文件
3. 系统会根据规则检查数据并显示结果
4. 可导出检查结果为CSV文件

### 医学实体识别

1. 点击首页中的"传统医学实体识别"或"大模型实体识别"
2. 输入医学文本或上传文本文件
3. 系统会识别文本中的医学实体并高亮显示
4. 大模型识别还会生成饼状图展示各类实体占比

### 文本转Excel

1. 点击首页中的"文本转Excel"
2. 输入医疗记录文本或上传文本文件
3. 系统会解析文本并生成Excel文件

### 数据库转Excel

1. 点击首页中的"数据库转Excel"
2. 配置数据库连接信息
3. 选择要导出的数据类型
4. 系统会从数据库中导出数据并生成Excel文件

## 项目结构

```
电子病案首页质控系统/
├── app.py                # 主应用文件
├── requirements.txt      # 依赖包列表
├── medical_entities.py   # 医学实体识别模块
├── text_to_excel.py      # 文本转Excel模块
├── llm_ner.py            # 大模型实体识别模块
├── export_medical_records.py  # 数据库导出模块
├── data/                 # 数据存储目录
│   ├── rules.json        # 规则配置文件
│   ├── medical_entities.json  # 医学实体字典
│   └── llm_config.json   # 大模型配置文件
├── uploads/              # 上传文件存储目录
├── excel_data/           # 生成的Excel文件存储目录
├── templates/            # HTML模板目录
│   ├── base.html         # 基础模板
│   ├── index.html        # 首页模板
│   ├── rules.html        # 规则管理页面
│   ├── check.html        # 数据检查页面
│   ├── results.html      # 结果显示页面
│   ├── entity_recognition.html       # 实体识别页面
│   ├── entity_recognition_result.html # 实体识别结果页面
│   ├── llm_entity_recognition.html    # 大模型实体识别页面
│   ├── llm_entity_recognition_result.html # 大模型实体识别结果页面
│   ├── text_to_excel.html            # 文本转Excel页面
│   └── database_to_excel.html        # 数据库转Excel页面
└── static/               # 静态资源目录
    ├── css/              # CSS样式文件
    ├── js/               # JavaScript文件
    └── img/              # 图片资源
```

## 扩展与定制

系统设计支持灵活扩展：

1. **添加新规则类型**：可以在`app.py`中的`check_rules`函数添加新的规则类型处理逻辑
2. **扩展医学实体字典**：可以编辑`data/medical_entities.json`文件，添加或修改医学实体
3. **集成其他大模型**：可以修改`llm_ner.py`，集成其他医学领域的预训练模型
4. **数据库集成**：可以将文件存储替换为数据库存储，提高性能和可靠性

## 贡献与反馈

欢迎提交问题报告、功能建议或代码贡献。您可以通过以下方式参与项目：

1. 提交Issue报告bug或提出新功能建议
2. 提交Pull Request贡献代码
3. 完善文档和使用说明

## 许可证

本项目采用MIT许可证。详细信息请参阅LICENSE文件。 