# 电子病案首页质控系统

这是一个基于Python和Flask的电子病案首页质控系统，用于检查病案首页数据中的缺项和逻辑错误，帮助医疗机构提高病案质量，规范医疗记录。

## 项目背景

医疗机构的病案首页是医疗记录的重要组成部分，包含了患者的基本信息、诊断结果、治疗过程等关键数据。高质量的病案首页对于医疗质量管理、医保报销、医学研究等都有重要意义。本系统旨在通过自动化检查，帮助医疗机构发现并解决病案首页中的各类问题。

## 功能特点

- **自定义质控规则管理**：
  - 添加、修改、删除规则
  - 直观的Web界面配置规则
  - 规则持久化存储

- **多种类型的规则检查**：
  - **缺项检查**：检查字段是否为空或非空
  - **逻辑检查**：根据条件检查字段值（等于、不等于、大于、小于、包含、不包含）
  - **关联逻辑检查**：检查两个字段之间的值关系，包括：
    - 性别与科室的匹配（如男性不应在妇产科就诊）
    - 年龄与科室的匹配（如成年人不应在儿科就诊）
    - 科室与诊断的匹配（如神经科应对应神经系统疾病）
    - 自定义字段间的关联关系

- **数据处理功能**：
  - 上传Excel格式的病案首页数据进行检查
  - 智能解析不同格式的数据
  - 批量处理大量病例数据

- **结果展示与处理**：
  - 直观显示检查结果，高亮错误数据
  - 详细的错误描述和位置信息
  - 支持导出检查结果为CSV文件，便于后续处理

- **健壮性设计**：
  - 异常处理机制确保系统稳定运行
  - 规则隔离执行，单个规则错误不影响整体检查
  - 详细的日志记录，便于问题排查

## 系统架构

- **前端**：HTML、CSS、JavaScript、Bootstrap 5
- **后端**：Python、Flask
- **数据处理**：Pandas、Openpyxl
- **数据存储**：JSON文件存储规则，支持扩展为数据库存储

## 安装与部署

### 环境要求

- Python 3.6+
- 支持Windows、Linux、MacOS等操作系统

### 安装步骤

1. 克隆或下载本项目代码
2. 安装依赖包：

```bash
pip install -r requirements.txt
```

3. 创建必要的目录（如果不存在）：

```bash
mkdir -p data uploads
```

4. 运行应用：

```bash
python app.py
```

5. 在浏览器中访问：`http://127.0.0.1:5000`

### 生产环境部署

对于生产环境，建议：

1. 使用Gunicorn或uWSGI作为WSGI服务器
2. 配置Nginx作为反向代理
3. 设置适当的安全策略，如HTTPS、访问控制等
4. 修改`app.py`中的`app.secret_key`为强随机密钥
5. 将`debug=False`设置在生产环境中

## 使用指南

### 规则管理

1. 点击导航栏中的"规则管理"，进入规则管理页面
2. 添加新规则：
   - 填写规则名称（如"姓名必填检查"）
   - 选择规则类型（缺项检查/逻辑检查/关联逻辑检查）
   - 根据规则类型填写相应的检查条件
   - 填写错误提示信息
   - 点击"添加规则"按钮

3. 编辑规则：
   - 在规则列表中找到需要编辑的规则
   - 点击"编辑"按钮
   - 修改规则信息
   - 点击"保存"按钮

4. 删除规则：
   - 在规则列表中找到需要删除的规则
   - 点击"删除"按钮
   - 确认删除操作

### 数据检查

1. 点击导航栏中的"数据检查"，进入数据检查页面
2. 点击"选择文件"按钮，选择Excel格式的病案首页数据文件
3. 点击"上传并检查"按钮，系统开始分析数据
4. 检查完成后，页面显示检查结果：
   - 顶部显示问题统计信息
   - 中部显示详细的错误列表
   - 底部显示原始数据表格，有问题的行会被高亮

5. 查看详情：
   - 点击错误列表中的"查看详情"按钮，查看每个问题的详细信息
   - 系统会高亮显示有问题的数据行

6. 导出结果：
   - 点击"导出结果"按钮，将检查结果导出为CSV文件
   - 导出的文件包含规则名称、错误信息和错误行号

## 特色规则示例

### 1. 科室与诊断匹配检查

系统内置了详细的科室与诊断对应关系知识库，能自动检查患者的就诊科室与入院诊断是否匹配。例如：

- 神经科应对应脑梗塞、帕金森病等神经系统疾病
- 呼吸科应对应肺炎、支气管炎等呼吸系统疾病
- 心血管科应对应冠心病、心肌梗死等心血管系统疾病

当发现不匹配时（如神经科收治了支气管炎患者），系统会自动标记为错误。

### 2. 年龄与科室匹配检查

系统能检查患者年龄与就诊科室是否合理。例如：

- 14岁以上患者不应在儿科就诊
- 儿童患者不应在成人专科就诊

### 3. 日期逻辑检查

系统能智能识别和比较日期字段，进行如下检查：

- 出院日期不能早于入院日期
- 手术日期应在住院期间
- 出生日期与年龄是否匹配

## 项目结构

```
电子病案首页质控系统/
├── app.py                # 主应用文件
├── requirements.txt      # 依赖包列表
├── data/                 # 数据存储目录
│   ├── rules.json        # 规则配置文件
│   └── diagnosis_department_mapping.json  # 科室诊断映射
├── uploads/              # 上传文件存储目录
├── templates/            # HTML模板目录
│   ├── base.html         # 基础模板
│   ├── index.html        # 首页模板
│   ├── rules.html        # 规则管理页面
│   ├── check.html        # 数据检查页面
│   └── results.html      # 结果显示页面
├── static/               # 静态资源目录
│   ├── css/              # CSS样式文件
│   ├── js/               # JavaScript文件
│   └── img/              # 图片资源
└── README.md             # 项目说明文档
```

## 扩展与定制

系统设计支持灵活扩展：

1. **添加新规则类型**：可以在`app.py`中的`check_rules`函数添加新的规则类型处理逻辑
2. **自定义知识库**：可以编辑`data/diagnosis_department_mapping.json`文件，添加或修改科室与诊断的对应关系
3. **数据库集成**：可以将文件存储替换为数据库存储，提高性能和可靠性
4. **报表功能**：可以添加统计分析和报表生成功能

## 贡献与反馈

欢迎提交问题报告、功能建议或代码贡献。您可以通过以下方式参与项目：

1. 提交Issue报告bug或提出新功能建议
2. 提交Pull Request贡献代码
3. 完善文档和使用说明

## 许可证

本项目采用MIT许可证。详细信息请参阅LICENSE文件。 